(()=>{"use strict";var e={290:function(e,t,i){var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(t,i);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,r)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),r=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||n(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),r(i(326),t)},429:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ContextPool=void 0;const n=i(562);class r{static get(e){return this.contexts.get(e)}static delete(e){var t;(null===(t=this.bind)||void 0===t?void 0:t.id)==e&&(this.bind=null),this.contexts.delete(e)}}t.ContextPool=r,r.contexts=new n.ResourceManager,r.bind=null},562:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ResourceManager=void 0,t.ResourceManager=class{constructor(){this._pool=new Map}add(e,t){this._pool.has(e)&&(this._pool.get(e).delete(),this._pool.delete(e)),this._pool.set(e,t)}check(e){return this._pool.has(e)}get(e){return this._pool.get(e)}delete(e){this.check(e)&&(this._pool.get(e).delete(),this._pool.delete(e))}clear(){for(const[e,t]of this._pool.entries())t.delete();this._pool.clear()}}},813:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Resource=void 0,t.Resource=class{constructor(e,t){this._context=e,this.id=t}}},533:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Blend=void 0;const n=i(429);class r{static enable(){let e=n.ContextPool.bind;if(null!=e){let t=e.gl;t.enable(t.BLEND)}}static disable(){let e=n.ContextPool.bind;if(null!=e){let t=e.gl;t.disable(t.BLEND)}}static getFunction(e){let t=n.ContextPool.bind;if(null!=t){let i=t.gl;return[i.ZERO,i.ONE,i.SRC_COLOR,i.ONE_MINUS_SRC_COLOR,i.DST_COLOR,i.ONE_MINUS_DST_COLOR,i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA,i.DST_ALPHA,i.ONE_MINUS_DST_ALPHA,i.CONSTANT_COLOR,i.ONE_MINUS_CONSTANT_COLOR,i.CONSTANT_ALPHA,i.ONE_MINUS_CONSTANT_ALPHA][e]}return 0}static setFunction(e,t){let i=n.ContextPool.bind;null!=i&&i.gl.blendFunc(this.getFunction(e),this.getFunction(t))}static setFunctionSeparate(e,t,i,r){let o=n.ContextPool.bind;null!=o&&o.gl.blendFuncSeparate(this.getFunction(e),this.getFunction(t),this.getFunction(i),this.getFunction(r))}}t.Blend=r,r.Zero=0,r.One=1,r.SrcColor=2,r.OneMinusSrcColor=3,r.DestColor=4,r.OneMinusDestColor=5,r.SrcAlpha=6,r.OneMinusSrcAlpha=7,r.DestAlpha=8,r.OneMinusDestAlpha=9,r.ConstantColor=10,r.OneMinusConstantColor=11,r.ConstantAlpha=12,r.OneMinusConstantAlpha=13},558:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Context=void 0;const n=i(813),r=i(562),o=i(429),s=i(512),a=i(599),l=i(942),c=i(709),d=i(178),u=i(936),h=i(955),v=i(529),x=i(532);class f extends v.Vertex{constructor(e,t){super(),this.coord=e,this.tex=t}getData(){return[this.coord,this.tex]}}const _=[new f([0,0],[0,1]),new f([1,1],[1,0]),new f([1,0],[1,1]),new f([0,1],[0,0])],g=[0,1,2,1,0,3];class b extends n.Resource{get currentTexture(){return this._currentTexture}get currentShader(){return this._currentShader}get currentFBO(){return this._currentFBO}get currentVBO(){return this._currentVBO}get currentEBO(){return this._currentEBO}get currentVAO(){return this._currentVAO}constructor(e,t,i){var n;if(super(null,t),this.element=e,this.textures=new r.ResourceManager,this.shaders=new r.ResourceManager,this.meshes=new r.ResourceManager,null!=e){i[0]<=0&&(i[0]=1),i[1]<=0&&(i[1]=1),this._container=document.createElement("div"),this._container.className="devon-webgl-canvas-container",this._container.style.width=`${i[0]}px`,this._container.style.height=`${i[1]}px`,this._container.style.display="block",this._container.style.zIndex="-1",this._canvas=document.createElement("canvas"),this._canvas.className="devon-webgl-canvas-view",this._canvas.style.position="absolute",this._container.appendChild(this._canvas),e.replaceWith(this._container),this.gl=null===(n=this._canvas)||void 0===n?void 0:n.getContext("webgl2",{alpha:!0,stencil:!0,preserveDrawingBuffer:!0});let t=o.ContextPool.bind;o.ContextPool.bind=this;let r=window.devicePixelRatio;i=[Math.round(i[0]*r),Math.round(i[1]*r)],h.Texture.create("fbo_devon_webgl",i),d.Shader.create("shader_devon_webgl","#version 300 es\n\nlayout (location = 0) in vec2 vecFragCoord;\nlayout (location = 1) in vec2 vecTexCoord;\n\nout vec2 texCoord;\n\nuniform mat4 projection;\n\nvoid main(void)\n{\n\ttexCoord = vecTexCoord;\n\tgl_Position = projection * vec4(vecFragCoord, 0, 1);\n}\n","#version 300 es\nprecision highp float;\n\nin vec2 texCoord;\nout vec4 fragColor;\nuniform sampler2D renderTexture;\n\nvoid main(void)\n{\n\tfragColor = texture(renderTexture, texCoord);\n}\n"),c.Mesh.createStatic("mesh_devon_webgl",_,g),o.ContextPool.bind=t,b._fullscreenInit||(document.addEventListener("fullscreenchange",(function(){b._fullscreen=!b._fullscreen,b._fullscreen||window.scrollTo(b._savedScroll[0],b._savedScroll[1])})),b._fullscreenInit=!0)}}bind(){const e=this._container.getBoundingClientRect();let t=window.devicePixelRatio;this._canvas.width=Math.round(e.width*t),this._canvas.height=Math.round(e.height*t),b._fullscreen?(this._canvas.style.left=`${e.left}px`,this._canvas.style.top=`${e.top}px`):(this._canvas.style.left=`${window.scrollX+e.left}px`,this._canvas.style.top=`${window.scrollY+e.top}px`),this._canvas.style.width=this._canvas.width/t+"px",this._canvas.style.height=this._canvas.height/t+"px";let i=h.Texture.getSize("fbo_devon_webgl");i[0]==this._canvas.width&&i[1]==this._canvas.height||(i=[this._canvas.width,this._canvas.height],h.Texture.createBlank("fbo_devon_webgl",[this._canvas.width,this._canvas.height])),h.Texture.setRenderTarget("fbo_devon_webgl")}draw(){this._currentFBO=null,this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),x.Viewport.set([0,0],[this._canvas.width,this._canvas.height]),a.Depth.disable(),u.Stencil.disable(),u.Stencil.setMask(255),u.Stencil.setFunction(u.Stencil.Always,1,255),s.Cull.disable();let e=l.Matrix.ortho([0,0],[1,1],[0,1]);d.Shader.bind("shader_devon_webgl"),d.Shader.setTexture("renderTexture",-1),d.Shader.setMatrix4("projection",e),h.Texture.setActive(-1,"fbo_devon_webgl"),c.Mesh.draw("mesh_devon_webgl")}resize(e){this._container.style.width=`${e[0]}px`,this._container.style.height=`${e[1]}px`}getSize(){return h.Texture.getSize("fbo_devon_webgl")}bindTexture(e){this._currentTexture!=e&&(this._currentTexture=e,this.gl.bindTexture(this.gl.TEXTURE_2D,e))}bindShader(e){this._currentShader!=e&&(this._currentShader=e,this.gl.useProgram(e))}bindFramebuffer(e){null==e?h.Texture.setRenderTarget("fbo_devon_webgl"):this._currentFBO!=e&&(this._currentFBO=e,this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,e))}bindVertexBuffer(e){this._currentVBO!=e&&(this._currentVBO=e,this.gl.bindBuffer(this.gl.ARRAY_BUFFER,e))}bindElementBuffer(e){this._currentEBO!=e&&(this._currentEBO=e,this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,e))}bindVertexArray(e){this._currentVAO!=e&&(this._currentVAO=e,this.gl.bindVertexArray(e))}deleteTexture(e){null!=e&&(this._currentTexture==e&&this.bindTexture(null),this.gl.deleteTexture(e))}deleteShader(e){null!=e&&(this._currentShader==e&&this.bindShader(null),this.gl.deleteProgram(e))}deleteFramebuffer(e){null!=e&&(this._currentFBO==e&&this.bindFramebuffer(null),this.gl.deleteFramebuffer(e))}deleteVertexBuffer(e){null!=e&&(this._currentVBO==e&&this.bindVertexBuffer(null),this.gl.deleteBuffer(e))}deleteElementBuffer(e){null!=e&&(this._currentEBO==e&&this.bindElementBuffer(null),this.gl.deleteBuffer(e))}deleteVertexArray(e){null!=e&&(this._currentVAO==e&&this.bindVertexArray(null),this.gl.deleteVertexArray(e))}delete(){this.textures.clear(),this.shaders.clear(),this.meshes.clear()}static create(e,t,i){let n=new b(t,e,i);o.ContextPool.contexts.add(e,n)}static bind(e){let t=o.ContextPool.get(e);null!=t&&(o.ContextPool.bind=t,t.bind())}static clear(e){let t=o.ContextPool.bind;if(null!=t){let i=t.gl;i.clearColor(...e),i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT|i.STENCIL_BUFFER_BIT)}}static draw(){var e;null===(e=o.ContextPool.bind)||void 0===e||e.draw()}static resize(e){var t;null===(t=o.ContextPool.bind)||void 0===t||t.resize(e)}static getSize(){var e;return null===(e=o.ContextPool.bind)||void 0===e?void 0:e.getSize()}static setFullscreen(e){let t=o.ContextPool.get(e);null!=t&&(t._container.requestFullscreen(),this._savedScroll=[window.scrollX,window.scrollY])}static getContainer(e){var t;return null===(t=o.ContextPool.get(e))||void 0===t?void 0:t._container}static getCanvas(e){var t;return null===(t=o.ContextPool.get(e))||void 0===t?void 0:t._canvas}static delete(e){o.ContextPool.delete(e)}}t.Context=b},512:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Cull=void 0;const n=i(429);class r{static enable(){let e=n.ContextPool.bind;if(null!=e){let t=e.gl;t.enable(t.CULL_FACE)}}static disable(){let e=n.ContextPool.bind;if(null!=e){let t=e.gl;t.disable(t.CULL_FACE)}}static setFace(e){let t=n.ContextPool.bind;if(null!=t){let i=t.gl;i.cullFace([i.FRONT,i.BACK,i.FRONT_AND_BACK][e])}}static setFront(e){let t=n.ContextPool.bind;if(null!=t){let i=t.gl;i.frontFace([i.CW,i.CCW][e])}}}t.Cull=r,r.Front=0,r.Back=1,r.FrontBack=1,r.Clockwise=0,r.CounterClockwise=1},599:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Depth=void 0;const n=i(429);class r{static enable(){let e=n.ContextPool.bind;if(null!=e){let t=e.gl;t.enable(t.DEPTH_TEST)}}static disable(){let e=n.ContextPool.bind;if(null!=e){let t=e.gl;t.disable(t.DEPTH_TEST)}}static clear(){let e=n.ContextPool.bind;if(null!=e){let t=e.gl;t.clear(t.DEPTH_BUFFER_BIT)}}static setFunction(e){let t=n.ContextPool.bind;if(null!=t){let i=t.gl;i.depthFunc([i.ALWAYS,i.NEVER,i.EQUAL,i.NOTEQUAL,i.LESS,i.LEQUAL,i.GREATER,i.GEQUAL][e])}}static setMask(e){let t=n.ContextPool.bind;null!=t&&t.gl.depthMask(e)}}t.Depth=r,r.Always=0,r.Never=1,r.Equal=2,r.NotEqual=3,r.Less=4,r.LessEqual=5,r.Greater=6,r.GreaterEqual=7},326:function(e,t,i){var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(t,i);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,r)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),r=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||n(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),r(i(533),t),r(i(558),t),r(i(512),t),r(i(599),t),r(i(942),t),r(i(709),t),r(i(754),t),r(i(178),t),r(i(936),t),r(i(955),t),r(i(425),t),r(i(529),t),r(i(532),t)},942:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Matrix=void 0,t.Matrix=class{static ortho(e,t,i){let n=e[0],r=e[0]+t[0],o=e[1],s=e[1]+t[1];return[2/(r-n),0,0,0,0,2/(o-s),0,0,0,0,-2/(i[1]-i[0]),0,-(r+n)/(r-n),-(o+s)/(o-s),0,1]}static perspective(e,t,i){let n=1/Math.tan(e*(Math.PI/180)/2),r=1/(i[1]-i[0]);return[1/(t[0]/t[1])*n,0,0,0,0,n,0,0,0,0,-(i[1]+i[0])*r,-1,0,0,-2*i[1]*i[0]*r,0]}static multiply(e,t){return[e[0]*t[0]+e[4]*t[1]+e[8]*t[2]+e[12]*t[3],e[1]*t[0]+e[5]*t[1]+e[9]*t[2]+e[13]*t[3],e[2]*t[0]+e[6]*t[1]+e[10]*t[2]+e[14]*t[3],e[3]*t[0]+e[7]*t[1]+e[11]*t[2]+e[15]*t[3],e[0]*t[4]+e[4]*t[5]+e[8]*t[6]+e[12]*t[7],e[1]*t[4]+e[5]*t[5]+e[9]*t[6]+e[13]*t[7],e[2]*t[4]+e[6]*t[5]+e[10]*t[6]+e[14]*t[7],e[3]*t[4]+e[7]*t[5]+e[11]*t[6]+e[15]*t[7],e[0]*t[8]+e[4]*t[9]+e[8]*t[10]+e[12]*t[11],e[1]*t[8]+e[5]*t[9]+e[9]*t[10]+e[13]*t[11],e[2]*t[8]+e[6]*t[9]+e[10]*t[10]+e[14]*t[11],e[3]*t[8]+e[7]*t[9]+e[11]*t[10]+e[15]*t[11],e[0]*t[12]+e[4]*t[13]+e[8]*t[14]+e[12]*t[15],e[1]*t[12]+e[5]*t[13]+e[9]*t[14]+e[13]*t[15],e[2]*t[12]+e[6]*t[13]+e[10]*t[14]+e[14]*t[15],e[3]*t[12]+e[7]*t[13]+e[11]*t[14]+e[15]*t[15]]}static vectorDot(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}static vectorCross(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]}static vectorNormalize(e){let t=Math.sqrt(this.vectorDot([e[0],e[1],e[2]],[e[0],e[1],e[2]]));return[e[0]/t,e[1]/t,e[2]/t]}static view3D(e,t,i){let n=this.vectorNormalize([e[0]-t[0],e[1]-t[1],e[2]-t[2]]),r=this.vectorCross([i[0],i[1],i[2]],[n[0],n[1],n[2]]),o=this.vectorNormalize([r[0],r[1],r[2]]),s=this.vectorCross([n[0],n[1],n[2]],[o[0],o[1],o[2]]),a=-this.vectorDot([o[0],o[1],o[2]],[e[0],e[1],e[2]]),l=-this.vectorDot([s[0],s[1],s[2]],[e[0],e[1],e[2]]),c=-this.vectorDot([n[0],n[1],n[2]],[e[0],e[1],e[2]]);return[o[0],o[1],o[2],0,s[0],s[1],s[2],0,n[0],n[1],n[2],0,a,l,c,1]}static view2D(e){return[1,0,0,0,0,1,0,0,0,0,1,0,e[0],e[1],0,1]}static translate(e){return[1,0,0,0,0,1,0,0,0,0,1,0,e[0],e[1],e[2],1]}static translate2D(e){return this.translate([e[0],e[1],0])}static translateX(e){return this.translate([e,0,0])}static translateY(e){return this.translate([0,e,0])}static translateZ(e){return this.translate([0,0,e])}static rotate(e){let t=this.rotateX(e[0]);return t=this.multiply(t,this.rotateY(e[1])),t=this.multiply(t,this.rotateZ(e[2])),t}static rotate2D(e){return this.rotateZ(e)}static rotateX(e){let t=Math.sin(e),i=Math.cos(e);return[1,0,0,0,0,i,t,0,0,-t,i,0,0,0,0,1]}static rotateY(e){let t=Math.sin(e),i=Math.cos(e);return[i,0,-t,0,0,1,0,0,t,0,i,0,0,0,0,1]}static rotateZ(e){let t=Math.sin(e),i=Math.cos(e);return[i,t,0,0,-t,i,0,0,0,0,1,0,0,0,0,1]}static scale(e){return[e[0],0,0,0,0,e[1],0,0,0,0,e[2],0,0,0,0,1]}static scale2D(e){return this.scale([e[0],e[1],1])}static scaleX(e){return this.scale([e,1,1])}static scaleY(e){return this.scale([1,e,1])}static scaleZ(e){return this.scale([1,1,e])}static model3D(e,t,i){let n=this.translate(e);return n=this.multiply(n,this.rotate(t)),n=this.multiply(n,this.scale(i)),n}static model2D(e,t,i){let n=this.translate2D(e);return n=this.multiply(n,this.rotate2D(t)),n=this.multiply(n,this.scale2D(i)),n}}},709:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Mesh=void 0;const n=i(813),r=i(429);class o extends n.Resource{get vertices(){return this._dynamic?this._vertices:this._vertices.map((e=>Object.assign({},e)))}get elements(){return this._dynamic?this._elements:this._elements.map((e=>Object.assign({},e)))}constructor(e,t,i){super(e,t),this._dynamic=i,this._vertices=new Array,this._elements=new Array;let n=this._context.gl;this._vao=n.createVertexArray()}createVBO(){if(this._vertices.length>0){let e=this._context.gl;this._vbo=e.createBuffer(),this._context.bindVertexArray(this._vao),this._context.bindVertexBuffer(this._vbo),e.bufferData(e.ARRAY_BUFFER,this.getRawVertexData(),this._dynamic?e.DYNAMIC_DRAW:e.STATIC_DRAW);let t=0,i=this._vertices[0],n=i.getLength();for(let r=0;r<i.getAttributeCount();r++){let o=i.getAttributeLength(r);e.enableVertexAttribArray(r),e.vertexAttribPointer(r,o,e.FLOAT,!1,4*n,4*t),t+=o}this._context.bindVertexArray(null),this._context.bindVertexBuffer(null)}this._prevVBOLen=this._vertices.length}createEBO(){if(this._elements.length>0){let e=this._context.gl;this._ebo=e.createBuffer(),this._context.bindVertexArray(this._vao),this._context.bindElementBuffer(this._ebo),e.bufferData(e.ELEMENT_ARRAY_BUFFER,this.getRawElementData(),this._dynamic?e.DYNAMIC_DRAW:e.STATIC_DRAW),this._context.bindVertexArray(null),this._context.bindElementBuffer(null)}this._prevEBOLen=this._elements.length}getRawVertexData(){if(0==this._vertices.length)return new Float32Array(0);let e=this._vertices[0].getLength(),t=new Float32Array(this._vertices.length*e);for(let i=0;i<this._vertices.length;i++)t.set(this._vertices[i].getData().flat(),i*e);return t}getRawElementData(){return Uint16Array.from(this._elements)}setData(e,t,i,n){if(n||this._dynamic){let n=e.length-Math.max(0,i+e.length-t.length),r=0;for(;r<n;)t[r+i]=e[r],r++;for(let i=0;i<e.length-n;i++)t.push(e[r++])}}setVertexArray(e,t,i){this.setData(e,this._vertices,t,i)}setElementArray(e,t,i){this.setData(e,this._elements,t,i)}clearVertices(e){this._dynamic&&(this._vertices=new Array(e))}clearElements(e){this._dynamic&&(this._elements=new Array(e))}flushVertices(){if(this._dynamic&&null!=this._vbo){let e=this._context.gl;if(this._elements.length>0){this._context.bindVertexBuffer(this._vbo);let t=this.getRawVertexData();this._prevVBOLen==this._vertices.length?e.bufferSubData(e.ARRAY_BUFFER,0,t):e.bufferData(e.ARRAY_BUFFER,t,e.DYNAMIC_DRAW),this._context.bindVertexBuffer(null)}else this._context.deleteVertexBuffer(this._vbo),this._vbo=null}else this.createVBO();this._prevVBOLen=this._vertices.length}flushElements(){if(this._dynamic&&null!=this._ebo){let e=this._context.gl;if(this._elements.length>0){this._context.bindElementBuffer(this._ebo);let t=this.getRawElementData();this._prevEBOLen==this._elements.length?e.bufferSubData(e.ELEMENT_ARRAY_BUFFER,0,t):e.bufferData(e.ELEMENT_ARRAY_BUFFER,t,e.DYNAMIC_DRAW),this._context.bindElementBuffer(null)}else this._context.deleteElementBuffer(this._ebo),this._ebo=null}else this.createEBO();this._prevEBOLen=this._elements.length}draw(){this.partialDraw(0,null!=this._ebo?this._elements.length:this._vertices.length)}partialDraw(e,t){if(null!=this._vbo){let i=this._context.gl;this._context.bindVertexArray(this._vao),null!=this._ebo?i.drawElements(i.TRIANGLES,Math.min(t,this._elements.length),i.UNSIGNED_SHORT,e):i.drawArrays(i.TRIANGLES,e,Math.min(t,this._vertices.length)),this._context.bindVertexArray(null)}}delete(){this._context.deleteVertexArray(this._vao),this._context.deleteVertexBuffer(this._vbo),this._context.deleteElementBuffer(this._ebo)}static getMesh(e){var t;return null===(t=r.ContextPool.bind)||void 0===t?void 0:t.meshes.get(e)}static createStatic(e,t,i){let n=r.ContextPool.bind;if(null!=n){let r=new o(n,e,!1);n.meshes.add(e,r),r.setVertexArray(t,0,!0),null!=i&&r.setElementArray(i,0,!0),r.createVBO(),r.createEBO()}}static createDynamic(e){let t=r.ContextPool.bind;if(null!=t){let i=new o(t,e,!0);t.meshes.add(e,i)}}static getVertices(e){var t;return null===(t=this.getMesh(e))||void 0===t?void 0:t.vertices}static getElements(e){var t;return null===(t=this.getMesh(e))||void 0===t?void 0:t.elements}static setVertexArray(e,t,i){var n;null===(n=this.getMesh(e))||void 0===n||n.setVertexArray(t,i,!1)}static setElementArray(e,t,i){var n;null===(n=this.getMesh(e))||void 0===n||n.setElementArray(t,i,!1)}static clearVertices(e,t){var i;null===(i=this.getMesh(e))||void 0===i||i.clearVertices(t)}static clearElements(e,t){var i;null===(i=this.getMesh(e))||void 0===i||i.clearElements(t)}static flushVertices(e){var t;null===(t=this.getMesh(e))||void 0===t||t.flushVertices()}static flushElements(e){var t;null===(t=this.getMesh(e))||void 0===t||t.flushElements()}static flushData(e){let t=this.getMesh(e);null!=t&&(t.flushVertices(),t.flushElements())}static draw(e){var t;null===(t=this.getMesh(e))||void 0===t||t.draw()}static partialDraw(e,t,i){var n;null===(n=this.getMesh(e))||void 0===n||n.partialDraw(t,i)}static delete(e){var t;null===(t=r.ContextPool.bind)||void 0===t||t.meshes.delete(e)}static clear(){var e;null===(e=r.ContextPool.bind)||void 0===e||e.meshes.clear()}}t.Mesh=o},754:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Scissor=void 0;const n=i(429),r=i(532);t.Scissor=class{static enable(){let e=n.ContextPool.bind;if(null!=e){let t=e.gl;t.enable(t.SCISSOR_TEST)}}static disable(){let e=n.ContextPool.bind;if(null!=e){let t=e.gl;t.disable(t.SCISSOR_TEST)}}static setRegion(e,t){let i=n.ContextPool.bind;if(null!=i){let n=i.gl,o=r.Viewport.get();n.scissor(e[0],o[3]-e[1]-e[0],...t)}}}},178:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Shader=void 0;const n=i(813),r=i(429);class o extends n.Resource{constructor(e,t,i,n){super(e,t);let r=this._context.gl,o=r.createShader(r.VERTEX_SHADER);r.shaderSource(o,i),r.compileShader(o);let s=r.createShader(r.FRAGMENT_SHADER);r.shaderSource(s,n),r.compileShader(s),this._program=r.createProgram(),r.attachShader(this._program,o),r.attachShader(this._program,s),r.linkProgram(this._program),r.deleteShader(o),r.deleteShader(s)}delete(){this._context.deleteShader(this._program)}static create(e,t,i){let n=r.ContextPool.bind;if(null!=n){let r=new o(n,e,t,i);n.shaders.add(e,r)}}static bind(e){let t=r.ContextPool.bind;null!=t&&t.bindShader(t.shaders.get(e)._program)}static unbind(){var e;null===(e=r.ContextPool.bind)||void 0===e||e.bindShader(null)}static getUniform(e){var t,i;null===(t=r.ContextPool.bind)||void 0===t||t.gl.getUniform(null===(i=r.ContextPool.bind)||void 0===i?void 0:i.currentShader,e)}static getUniformLocation(e){var t,i;return null===(t=r.ContextPool.bind)||void 0===t?void 0:t.gl.getUniformLocation(null===(i=r.ContextPool.bind)||void 0===i?void 0:i.currentShader,e)}static setFloat(e,t){var i;null===(i=r.ContextPool.bind)||void 0===i||i.gl.uniform1f(this.getUniformLocation(e),t)}static setInt(e,t){var i;null===(i=r.ContextPool.bind)||void 0===i||i.gl.uniform1i(this.getUniformLocation(e),t)}static setVec2(e,t){var i;null===(i=r.ContextPool.bind)||void 0===i||i.gl.uniform2fv(this.getUniformLocation(e),t)}static setIVec2(e,t){var i;null===(i=r.ContextPool.bind)||void 0===i||i.gl.uniform2iv(this.getUniformLocation(e),t)}static setVec3(e,t){var i;null===(i=r.ContextPool.bind)||void 0===i||i.gl.uniform3fv(this.getUniformLocation(e),t)}static setIVec3(e,t){var i;null===(i=r.ContextPool.bind)||void 0===i||i.gl.uniform3iv(this.getUniformLocation(e),t)}static setVec4(e,t){var i;null===(i=r.ContextPool.bind)||void 0===i||i.gl.uniform4fv(this.getUniformLocation(e),t)}static setIVec4(e,t){var i;null===(i=r.ContextPool.bind)||void 0===i||i.gl.uniform4iv(this.getUniformLocation(e),t)}static setMatrix2(e,t){var i;null===(i=r.ContextPool.bind)||void 0===i||i.gl.uniformMatrix2fv(this.getUniformLocation(e),!1,t)}static setMatrix3(e,t){var i;null===(i=r.ContextPool.bind)||void 0===i||i.gl.uniformMatrix3fv(this.getUniformLocation(e),!1,t)}static setMatrix4(e,t){var i;null===(i=r.ContextPool.bind)||void 0===i||i.gl.uniformMatrix4fv(this.getUniformLocation(e),!1,t)}static setTexture(e,t){this.setInt(e,t+1)}static delete(e){var t;null===(t=r.ContextPool.bind)||void 0===t||t.shaders.delete(e)}static clear(){var e;null===(e=r.ContextPool.bind)||void 0===e||e.shaders.clear()}}t.Shader=o},936:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Stencil=void 0;const n=i(429);class r{static enable(){let e=n.ContextPool.bind;if(null!=e){let t=e.gl;t.enable(t.STENCIL_TEST)}}static disable(){let e=n.ContextPool.bind;if(null!=e){let t=e.gl;t.disable(t.STENCIL_TEST)}}static clear(){let e=n.ContextPool.bind;if(null!=e){let t=e.gl;t.clear(t.STENCIL_BUFFER_BIT)}}static setFunction(e,t,i){let r=n.ContextPool.bind;if(null!=r){let n=r.gl;n.stencilFunc([n.ALWAYS,n.NEVER,n.EQUAL,n.NOTEQUAL,n.LESS,n.LEQUAL,n.GREATER,n.GEQUAL][e],t,i)}}static setOptions(e,t,i){let r=n.ContextPool.bind;if(null!=r){let n=r.gl,o=[n.KEEP,n.ZERO,n.REPLACE,n.INCR,n.INCR_WRAP,n.DECR,n.DECR_WRAP,n.INVERT];n.stencilOp(o[e],o[t],o[i])}}static setMask(e){let t=n.ContextPool.bind;null!=t&&t.gl.stencilMask(e)}}t.Stencil=r,r.Always=0,r.Never=1,r.Equal=2,r.NotEqual=3,r.Less=4,r.LessEqual=5,r.Greater=6,r.GreaterEqual=7,r.Keep=0,r.Zero=1,r.Replace=2,r.Increase=3,r.IncreaseWrap=4,r.Decrease=5,r.DecreaseWrap=6,r.Invert=7},955:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Texture=void 0;const n=i(813),r=i(429);class o extends n.Resource{get size(){return[this._size[0],this._size[1]]}get width(){return this._size[0]}get height(){return this._size[1]}get filter(){return this._filter}get minFilter(){return this._filter[0]}get magFilter(){return this._filter[1]}get wrap(){return this._wrap}get wrapX(){return this._wrap[0]}get wrapY(){return this._wrap[1]}constructor(e,t,i){super(e,t),this._size=[0,0],this._filter=[o.Bilinear,o.Bilinear],this._wrap=[o.Clamp,o.Clamp];let n=this._context.gl;this._texture=n.createTexture(),this._context.bindTexture(this._texture),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR_MIPMAP_LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),this.createBlank(i)}setFilter(e){this.setMinFilter(e),this.setMagFilter(e)}setMinFilter(e){let t=this._context.gl;this._context.bindTexture(this._texture),this._filter[0]=e;let i=[t.NEAREST,t.LINEAR,t.NEAREST_MIPMAP_LINEAR,t.LINEAR_MIPMAP_LINEAR];t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,i[e+(this._hasMipmap?2:0)])}setMagFilter(e){let t=this._context.gl;this._context.bindTexture(this._texture),this._filter[1]=e;let i=[t.NEAREST,t.LINEAR];t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,i[e])}getWrapMode(e){let t=this._context.gl;return[t.CLAMP_TO_EDGE,t.REPEAT,t.MIRRORED_REPEAT][e]}setWrap(e){this.setWrapX(e),this.setWrapY(e)}setWrapX(e){let t=this._context.gl;this._context.bindTexture(this._texture),this._wrap[0]=e,t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,this.getWrapMode(e))}setWrapY(e){let t=this._context.gl;this._context.bindTexture(this._texture),this._wrap[1]=e,t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,this.getWrapMode(e))}setRenderTarget(){let e=this._context.gl;null==this._fbo?(this._fbo=e.createFramebuffer(),null==this._depthBuffer&&(this._depthBuffer=e.createTexture()),this._context.bindTexture(this._depthBuffer),e.texImage2D(e.TEXTURE_2D,0,e.DEPTH24_STENCIL8,this._size[0],this._size[1],0,e.DEPTH_STENCIL,e.UNSIGNED_INT_24_8,null),this._context.bindFramebuffer(this._fbo),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this._texture,0),e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,this._depthBuffer,0)):this._context.bindFramebuffer(this._fbo),this.setMipmapCreate(!1)}createBlank(e){let t=this._context.gl;if(this._context.bindTexture(this._texture),e[0]<=0&&(e[0]=1),e[1]<=0&&(e[1]=1),e[0]!=this._size[0]||e[1]!=this._size[1]?t.texImage2D(t.TEXTURE_2D,0,t.RGBA,e[0],e[1],0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array(e[0]*e[1]*4)):t.texSubImage2D(t.TEXTURE_2D,0,0,0,e[0],e[1],t.RGBA,t.UNSIGNED_BYTE,new Uint8Array(e[0]*e[1]*4)),this._size=e,null!=this._fbo){let e=this._context.currentFBO;this._context.deleteFramebuffer(this._fbo),this._fbo=null,this.setRenderTarget(),this._context.bindFramebuffer(e)}else this.setMipmapCreate(!1)}loadImageFile(e){let t=new Image;t.crossOrigin="anonymous",t.src=e,t.onload=()=>{let e=this._context.currentTexture;this.loadImage(t),this._context.bindTexture(e)}}loadImage(e){let t=this._context.gl;this._context.bindTexture(this._texture),e.width!=this._size[0]||e.height!=this._size[1]?t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e):t.texSubImage2D(t.TEXTURE_2D,0,0,0,e.width,e.height,t.RGBA,t.UNSIGNED_BYTE,e),this._size=[e.width,e.height],this.setMipmapCreate(!1)}loadVideoFrame(e){if(0!=e.videoWidth&&0!=e.videoHeight){let t=this._context.gl;this._context.bindTexture(this._texture),e.videoWidth!=this._size[0]||e.videoHeight!=this._size[1]?t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e):t.texSubImage2D(t.TEXTURE_2D,0,0,0,e.videoWidth,e.videoHeight,t.RGBA,t.UNSIGNED_BYTE,e),this._size=[e.videoWidth,e.videoHeight],this.setMipmapCreate(!1)}}createMipmap(){let e=this._context.gl;this._context.bindTexture(this._texture),e.generateMipmap(e.TEXTURE_2D),this.setMipmapCreate(!0)}setMipmapCreate(e){this._hasMipmap=e,this.setMinFilter(this._filter[0])}delete(){this._context.deleteTexture(this._texture),this._context.deleteFramebuffer(this._fbo),this._context.deleteTexture(this._depthBuffer)}static getTexture(e){var t;return null===(t=r.ContextPool.bind)||void 0===t?void 0:t.textures.get(e)}static create(e,t=[1,1]){let i=r.ContextPool.bind;if(null!=i){let n=new o(i,e,t);i.textures.add(e,n)}}static getSize(e){var t;return null===(t=this.getTexture(e))||void 0===t?void 0:t.size}static getWidth(e){var t;return null===(t=this.getTexture(e))||void 0===t?void 0:t.width}static getHeight(e){var t;return null===(t=this.getTexture(e))||void 0===t?void 0:t.height}static getFilter(e){var t;return console.log(this.getTexture(e)),null===(t=this.getTexture(e))||void 0===t?void 0:t.filter}static getMinFilter(e){var t;return null===(t=this.getTexture(e))||void 0===t?void 0:t.minFilter}static getMagFilter(e){var t;return null===(t=this.getTexture(e))||void 0===t?void 0:t.magFilter}static getWrap(e){var t;return null===(t=this.getTexture(e))||void 0===t?void 0:t.wrap}static getWrapX(e){var t;return null===(t=this.getTexture(e))||void 0===t?void 0:t.wrapX}static getWrapY(e){var t;return null===(t=this.getTexture(e))||void 0===t?void 0:t.wrapY}static setFilter(e,t){var i;null===(i=this.getTexture(e))||void 0===i||i.setFilter(t)}static setMinFilter(e,t){var i;null===(i=this.getTexture(e))||void 0===i||i.setMinFilter(t)}static setMagFilter(e,t){var i;null===(i=this.getTexture(e))||void 0===i||i.setMagFilter(t)}static setWrap(e,t){var i;null===(i=this.getTexture(e))||void 0===i||i.setWrap(t)}static setWrapX(e,t){var i;null===(i=this.getTexture(e))||void 0===i||i.setWrapX(t)}static setWrapY(e,t){var i;null===(i=this.getTexture(e))||void 0===i||i.setWrapY(t)}static setActive(e,t){var i;let n=r.ContextPool.bind;if(null!=n){let r=n.gl;r.activeTexture(r.TEXTURE1+e),n.bindTexture(null===(i=this.getTexture(t))||void 0===i?void 0:i._texture),r.activeTexture(r.TEXTURE0)}}static unsetActive(e){let t=r.ContextPool.bind;if(null!=t){let i=t.gl;i.activeTexture(i.TEXTURE1+e),t.bindTexture(null),i.activeTexture(i.TEXTURE0)}}static setRenderTarget(e){var t;null===(t=this.getTexture(e))||void 0===t||t.setRenderTarget()}static unsetRenderTarget(){var e;null===(e=r.ContextPool.bind)||void 0===e||e.bindFramebuffer(null)}static createBlank(e,t){var i;null===(i=this.getTexture(e))||void 0===i||i.createBlank(t)}static loadImageFile(e,t){var i;null===(i=this.getTexture(e))||void 0===i||i.loadImageFile(t)}static loadImage(e,t){var i;null===(i=this.getTexture(e))||void 0===i||i.loadImage(t)}static loadVideoFrame(e,t){var i;null===(i=this.getTexture(e))||void 0===i||i.loadVideoFrame(t)}static createMipmap(e){var t;null===(t=this.getTexture(e))||void 0===t||t.createMipmap()}static delete(e){r.ContextPool.bind.textures.delete(e)}static clear(){r.ContextPool.bind.textures.clear()}}t.Texture=o,o.Nearest=0,o.Bilinear=1,o.Clamp=0,o.Repeat=1,o.Mirror=2},425:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},529:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Vertex=void 0,t.Vertex=class{getLength(){return this.getData().flat().length}getAttributeLength(e){return this.getData()[e].length}getAttributeCount(){return this.getData().length}}},532:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Viewport=void 0;const n=i(429);t.Viewport=class{static set(e,t){let i=n.ContextPool.bind;null!=i&&i.gl.viewport(...e,...t)}static get(){let e=n.ContextPool.bind;if(null!=e){let t=e.gl;return t.getParameter(t.VIEWPORT)}return[0,0,0,0]}}},155:function(e,t,i){var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(t,i);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,r)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)"default"!==i&&Object.prototype.hasOwnProperty.call(e,i)&&n(t,e,i);return r(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.Canvas1=void 0;const s=o(i(290)),a=i(353),l=`#version 300 es\nprecision highp float;\n\nin vec2 fragCoord;\nin vec2 texCoord;\nin vec2 pixelCoord;\nin vec2 imgTopLeft;\nin vec2 imgBtmRight;\n\nout vec4 fragColor;\n\nuniform sampler2D tex1;\nuniform sampler2D tex2;\nuniform vec2 tex1Size;\n\n${i(318).fragShaderLib}\n\t\nvoid main(void)\n{\n\tvec4 img = vec4(1, 1, 1, 1);\n\tvec4 color = vec4(hsvToRGB(vec3(time / 2.0, 0.5, 1)), 1);\n\t\n\tif ((fragCoord.x >= imgTopLeft.x && fragCoord.x <= imgBtmRight.x) &&\n\t\t(fragCoord.y >= imgTopLeft.y && fragCoord.y <= imgBtmRight.y)) {\n\t\timg = texture(tex2, vec2(\n\t\t\t(fragCoord.x - imgTopLeft.x) / (imgBtmRight.x - imgTopLeft.x),\n\t\t\t-(fragCoord.y - imgTopLeft.y) / (imgBtmRight.y - imgTopLeft.y)\n\t\t));\n\t}\n\t\n\tvec2 correct = resolution / tex1Size;\n\tvec2 t = (-correct / 2.0) + (texCoord * correct) + 0.5;\n\t\n\tfloat sinx = sinRange(radians((time * 50.0) + (pixelCoord.y * 2.0)) / 1.25, 1.00, 1.15);\n\tfloat siny = sinRange(radians((-time * 50.0) + (pixelCoord.y * 2.0)) * 2.0, 0.85, 1.15);\n\tfloat sinx2 = sinRange(radians((time * 50.0) + (pixelCoord.y * 4.0)), -0.05, 0.05) * (mod(floor(pixelCoord.y), 2.0) - 0.5);\n\t\n\tt.x = ((t.x * sinx) - (sinx / 2.0) - 0.5) + sinx2;\n\tt.y = (t.y * siny) - (siny / 2.0) - 0.5;\n\t\n\tfragColor = (texture(tex1, t) * color) / img;\n}\n`;class c extends s.Vertex{constructor(e,t){super(),this.coord=e,this.tex=t}getData(){return[this.coord,this.tex]}}const d=[new c([-1,-1],[0,0]),new c([1,1],[1,1]),new c([1,-1],[1,0]),new c([1,1],[1,1]),new c([-1,-1],[0,0]),new c([-1,1],[0,1])];class u extends a.Canvas{constructor(e){super(e,[480,480]),s.Texture.create("texture_bg"),s.Texture.loadImageFile("texture_bg","./img/test.png"),s.Texture.setWrap("texture_bg",s.Texture.Mirror),s.Texture.createMipmap("texture_bg"),s.Texture.create("texture_img"),s.Texture.loadImageFile("texture_img","./img/test2.png"),s.Texture.setWrap("texture_img",s.Texture.Repeat),s.Texture.createMipmap("texture_img"),s.Shader.create("shader","#version 300 es\n\nlayout (location = 0) in vec2 vecFragCoord;\nlayout (location = 1) in vec2 vecTexCoord;\n\nout vec2 fragCoord;\nout vec2 texCoord;\nout vec2 pixelCoord;\nout vec2 imgTopLeft;\nout vec2 imgBtmRight;\n\nuniform vec2 resolution;\nuniform mat4 projection;\nuniform mat4 model;\nuniform vec2 tex2Size;\n\nvoid main(void)\n{\n\tfragCoord = vecFragCoord;\n\ttexCoord = vecTexCoord;\n\tpixelCoord = fragCoord * resolution / 2.0;\n\t\n\tmat4 matrix = projection * model;\n\timgTopLeft = (matrix * vec4(-tex2Size.x / 2.0, tex2Size.x / 2.0, 0, 1)).xy;\n\timgBtmRight = (matrix * vec4(tex2Size.y / 2.0, -tex2Size.y / 2.0, 0, 1)).xy;\n\n\tgl_Position = vec4(vecFragCoord, 0, 1);\n}\n",l),s.Mesh.createStatic("mesh",d)}update(e,t){let i=s.Context.getSize(),n=s.Texture.getSize("texture_bg"),r=s.Texture.getSize("texture_img"),o=2*(Math.sin(e/15*(Math.PI/180))+1)+.5;s.Viewport.set([0,0],i),s.Context.clear([0,0,0,1]);let a=s.Matrix.ortho([-i[0]/2,-i[1]/2],i,[0,1]),l=s.Matrix.model2D([0,0],0,[o,o]);s.Shader.bind("shader"),s.Shader.setVec2("resolution",i),s.Shader.setFloat("time",e/1e3),s.Shader.setMatrix4("projection",a),s.Shader.setMatrix4("model",l),s.Shader.setTexture("tex1",0),s.Shader.setTexture("tex2",1),s.Shader.setVec2("tex1Size",n),s.Shader.setVec2("tex2Size",r),s.Texture.setActive(0,"texture_bg"),s.Texture.setActive(1,"texture_img"),s.Mesh.draw("mesh")}}t.Canvas1=u},876:function(e,t,i){var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(t,i);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,r)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)"default"!==i&&Object.prototype.hasOwnProperty.call(e,i)&&n(t,e,i);return r(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.Canvas2=void 0;const s=o(i(290)),a=i(353),l=`#version 300 es\nprecision highp float;\n\nin vec2 fragCoord;\nin vec2 texCoord;\nin vec2 pixelCoord;\n\nout vec4 fragColor;\n\nuniform sampler2D tex;\n\n${i(318).fragShaderLib}\n\t\nvoid main(void)\n{\n\tfloat segHeight = (30.0 / 256.0) * ((random() + 0.5) / 2.0);\n\tfloat segIntensity = sinRange(radians((time * 50.0) * 4.00), 0.0, 0.05);\n\tfloat fuzz = (random(pixelCoord.y + randomSeed) - 0.5) / 48.0;\n\tfloat xoff = ((step(mod(fragCoord.y + 1.0, segHeight * 2.0), segHeight) - 0.5) * segIntensity) + fuzz;\n\t\n\tvec4 color = vec4(hsvToRGB(vec3(\n\t\t(time / 4.0) + (fragCoord.y / 8.0) + (noise(texCoord, randomSeed) / 3.0),\n\t\t0.75,\n\t\tsin((fragCoord.y * 2.0) + time) + 2.0\n\t)), 1);\n\t\n\tfragColor = texture(tex, vec2(texCoord.x + xoff, texCoord.y)) / color;\n}\n`;class c extends s.Vertex{constructor(e,t){super(),this.coord=e,this.tex=t}getData(){return[this.coord,this.tex]}}const d=[new c([-.5,-.5],[0,0]),new c([.5,.5],[1,1]),new c([.5,-.5],[1,0]),new c([.5,.5],[1,1]),new c([-.5,-.5],[0,0]),new c([-.5,.5],[0,1])];class u extends a.Canvas{constructor(e){super(e,[480,480]),s.Texture.create("texture"),s.Texture.loadImageFile("texture","./img/test.png"),s.Texture.createMipmap("texture"),s.Shader.create("shader","#version 300 es\n\nlayout (location = 0) in vec2 vecFragCoord;\nlayout (location = 1) in vec2 vecTexCoord;\n\nout vec2 fragCoord;\nout vec2 texCoord;\nout vec2 pixelCoord;\n\nuniform vec2 resolution;\nuniform mat4 projection;\n\nvoid main(void)\n{\n\tfragCoord = vecFragCoord;\n\ttexCoord = vecTexCoord;\n\tpixelCoord = fragCoord * resolution / 2.0;\n\t\n\tgl_Position = projection * vec4(vecFragCoord, 0, 1);\n}\n",l),s.Mesh.createStatic("mesh",d)}update(e,t){let i=s.Context.getSize();s.Viewport.set([0,0],i),s.Context.clear([0,0,0,1]);let n=[i[0]/i[1],1];i[1]>i[0]&&(n=[1,i[1]/i[0]]);let r=s.Matrix.ortho([-n[0]/2,-n[1]/2],n,[0,1]);s.Shader.bind("shader"),s.Shader.setVec2("resolution",i),s.Shader.setFloat("time",e/1e3),s.Shader.setFloat("randomSeed",Math.random()),s.Shader.setMatrix4("projection",r),s.Shader.setTexture("tex",0),s.Texture.setActive(0,"texture"),s.Mesh.draw("mesh")}}t.Canvas2=u},239:function(e,t,i){var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(t,i);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,r)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)"default"!==i&&Object.prototype.hasOwnProperty.call(e,i)&&n(t,e,i);return r(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.Canvas3=void 0;const s=o(i(290)),a=i(353),l=`#version 300 es\nprecision highp float;\n\nin vec2 fragCoord;\nin vec2 texCoord;\nin vec2 pixelCoord;\n\nout vec4 fragColor;\n\nuniform sampler2D tex;\n\n${i(318).fragShaderLib}\n\nfloat getNeighbor(int x, int y, float xoff, float yoff, mat3 sobel)\n{\n\tvec2 coord = vec2(pixelCoord.x + float(x) + xoff, pixelCoord.y + float(y) + yoff) / resolution;\n\tvec4 pixel = texture(tex, coord) * sobel[x + 1][y + 1];\n\treturn (pixel.r + pixel.g + pixel.b) / 3.0;\n}\n\nfloat sobel(float xoff, float yoff)\n{\n\tmat3 sobelX;\n\tsobelX[0] = vec3(-1.0, 0.0, 1.0);\n\tsobelX[1] = vec3(-2.0, 0.0, 2.0);\n\tsobelX[2] = vec3(-1.0, 0.0, 1.0);\n\t\n\tmat3 sobelY;\n\tsobelY[0] = vec3( 1.0,  2.0,  1.0);\n\tsobelY[1] = vec3( 0.0,  0.0,  0.0);\n\tsobelY[2] = vec3(-1.0, -2.0, -1.0);\n\t\n\tfloat sx = getNeighbor(-1, -1, xoff, yoff, sobelX) +\n\t\tgetNeighbor(0, -1, xoff, yoff, sobelX) +\n\t\tgetNeighbor(1, -1, xoff, yoff, sobelX) +\n\t\tgetNeighbor(-1, 0, xoff, yoff, sobelX) +\n\t\tgetNeighbor(0, 0, xoff, yoff, sobelX) +\n\t\tgetNeighbor(1, 0, xoff, yoff, sobelX) +\n\t\tgetNeighbor(-1, 1, xoff, yoff, sobelX) +\n\t\tgetNeighbor(0, 1, xoff, yoff, sobelX) +\n\t\tgetNeighbor(1, 1, xoff, yoff, sobelX);\n\t\t\n\tfloat sy = getNeighbor(-1, -1, xoff, yoff, sobelY) +\n\t\tgetNeighbor(0, -1, xoff, yoff, sobelY) +\n\t\tgetNeighbor(1, -1, xoff, yoff, sobelY) +\n\t\tgetNeighbor(-1, 0, xoff, yoff, sobelY) +\n\t\tgetNeighbor(0, 0, xoff, yoff, sobelY) +\n\t\tgetNeighbor(1, 0, xoff, yoff, sobelY) +\n\t\tgetNeighbor(-1, 1, xoff, yoff, sobelY) +\n\t\tgetNeighbor(0, 1, xoff, yoff, sobelY) +\n\t\tgetNeighbor(1, 1, xoff, yoff, sobelY);\n\t\n\tfloat c = clamp(sqrt((sx * sx) + (sy * sy)), 0.0, 1.0);\n\tif (c <= 32.0 / 255.0) c = 0.0;\n\treturn c;\n}\n\nvec4 mixColor(vec4 c1, vec4 c2)\n{\n\tvec4 c = vec4(c1.r + c2.r, c1.g - c2.r, c1.b - c2.r, 1);\n\tc = vec4(c.r - c2.g, c.g + c2.g, c.b - c2.g, 1);\n\tc = vec4(c.r - c2.b, c.g - c2.b, c.b + c2.b, 1);\n\treturn clamp(c, 0.0, 1.0);\n}\n\nvoid main(void)\n{\n\tfloat d = 4.0;\n\n\tfloat cr = sobel(-d, 0.0);\n\tfloat cg = sobel(0.0, 0.0);\n\tfloat cb = sobel(d, 0.0);\n\t\n\tvec4 baseColor = texture(tex, texCoord);\n\tvec4 color = vec4(cr, cg, cb, 1);\n\t\n\tvec4 hue = vec4(hsvToRGB(vec3(\n\t\t(time / 4.0) + (fragCoord.y / 512.0) + (noise(texCoord, randomSeed) / 2.0),\n\t\t2.0, 2.0\n\t)) * noise(texCoord, randomSeed), 1);\n\t\n\tfragColor = (baseColor * hue) + color;\n}\n`;class c extends s.Vertex{constructor(e,t){super(),this.coord=e,this.tex=t}getData(){return[this.coord,this.tex]}}class d extends s.Vertex{constructor(e,t){super(),this.coord=e,this.tex=t}getData(){return[this.coord,this.tex]}}const u=[new c([0,0],[0,0]),new c([0,0],[1,1]),new c([0,0],[1,0]),new c([0,0],[1,1]),new c([0,0],[0,0]),new c([0,0],[0,1])],h=[new d([-1,-1,-1],[0,0]),new d([1,1,-1],[1,1]),new d([1,-1,-1],[1,0]),new d([-1,1,-1],[0,1]),new d([-1,-1,1],[0,0]),new d([1,-1,1],[1,0]),new d([1,1,1],[1,1]),new d([-1,1,1],[0,1]),new d([-1,1,1],[1,0]),new d([-1,1,-1],[1,1]),new d([-1,-1,-1],[0,1]),new d([-1,-1,1],[0,0]),new d([1,1,1],[1,0]),new d([1,-1,-1],[0,1]),new d([1,1,-1],[1,1]),new d([1,-1,1],[0,0]),new d([-1,-1,-1],[0,1]),new d([1,-1,-1],[1,1]),new d([1,-1,1],[1,0]),new d([-1,-1,1],[0,0]),new d([-1,1,-1],[0,1]),new d([1,1,1],[1,0]),new d([1,1,-1],[1,1]),new d([-1,1,1],[0,0])],v=[0,1,2,1,0,3,4,5,6,6,7,4,8,9,10,10,11,8,12,13,14,13,12,15,16,17,18,18,19,16,20,21,22,21,20,23];class x extends a.Canvas{constructor(e){super(e,[480,360]),this._videoPlaying=!1,this._videoTimeUpdate=!1,this._videoReady=!1,s.Texture.create("texture"),s.Shader.create("shader","#version 300 es\n\nlayout (location = 0) in vec2 vecFragCoord;\nlayout (location = 1) in vec2 vecTexCoord;\n\nout vec2 fragCoord;\nout vec2 texCoord;\nout vec2 pixelCoord;\n\nuniform vec2 resolution;\nuniform mat4 projection;\n\nvoid main(void)\n{\n\tfragCoord = vecFragCoord;\n\ttexCoord = vecTexCoord;\n\tpixelCoord = floor(vecTexCoord * resolution);\n\tgl_Position = projection * vec4(vecFragCoord, 0, 1);\n}\n",l),s.Shader.create("shader_cube","#version 300 es\n\nlayout (location = 0) in vec3 vecFragCoord;\nlayout (location = 1) in vec2 vecTexCoord;\n\nout vec2 texCoord;\n\nuniform mat4 projection;\nuniform mat4 view;\nuniform mat4 model;\n\nvoid main(void)\n{\n\ttexCoord = vecTexCoord;\n\tgl_Position = projection * view * model * vec4(vecFragCoord, 1);\n}\n","#version 300 es\nprecision highp float;\n\nin vec2 texCoord;\n\nout vec4 fragColor;\n\nuniform sampler2D tex;\n\nvoid main(void)\n{\n\tfragColor = texture(tex, texCoord);\n}\n"),s.Mesh.createDynamic("mesh"),s.Mesh.createStatic("mesh_cube",h,v),this.video=document.createElement("video"),this.video.playsInline=!0,this.video.loop=!0,this.video.width=10,this.video.height=480,this.video.addEventListener("playing",(()=>{this._videoPlaying=!0,this._videoReady=this._videoPlaying&&this._videoTimeUpdate}),!0),this.video.addEventListener("timeupdate",(()=>{this._videoTimeUpdate=!0,this._videoReady=this._videoPlaying&&this._videoTimeUpdate}),!0),this.video.src="./img/badapple.mp4"}updateMesh(){let e=this.video.videoWidth,t=this.video.videoHeight;if(this._videoReady&&0!=e&&0!=t){let i=s.Texture.getSize("texture");i[0]==e&&i[1]==t||(u[0].coord[0]=-e/2,u[0].coord[1]=-t/2,u[1].coord[0]=e/2,u[1].coord[1]=t/2,u[2].coord[0]=e/2,u[2].coord[1]=-t/2,u[3].coord[0]=e/2,u[3].coord[1]=t/2,u[4].coord[0]=-e/2,u[4].coord[1]=-t/2,u[5].coord[0]=-e/2,u[5].coord[1]=t/2,s.Mesh.setVertexArray("mesh",u,0),s.Mesh.flushVertices("mesh")),s.Texture.loadVideoFrame("texture",this.video),this._videoTimeUpdate=!1}}radians(e){return e*(Math.PI/180)}update(e,t){s.Depth.disable();let i=s.Context.getSize(),n=s.Texture.getSize("texture");s.Viewport.set([0,0],i),s.Context.clear([0,0,0,1]),this.updateMesh();let r=[n[1]*(i[0]/i[1]),n[1]];i[1]>i[0]&&(r=[n[0],n[0]*(i[1]/i[0])]);let o=s.Matrix.ortho([-r[0]/2,-r[1]/2],r,[0,1e3]);if(s.Shader.bind("shader"),s.Shader.setVec2("resolution",r),s.Shader.setFloat("time",e/1e3),s.Shader.setFloat("randomSeed",Math.random()),s.Shader.setMatrix4("projection",o),s.Shader.setTexture("tex",0),s.Texture.setActive(0,"texture"),s.Mesh.draw("mesh"),this._videoReady){let t=this.radians(e/25),n=12*Math.sin(t),r=12*Math.sin(2*t),a=12*Math.cos(t);s.Depth.enable(),s.Depth.setFunction(s.Depth.LessEqual),o=s.Matrix.perspective(60,i,[.1,1e3]);let l=s.Matrix.view3D([a,r,n],[0,0,0],[0,1,0]);s.Shader.bind("shader_cube"),s.Shader.setMatrix4("projection",o),s.Shader.setMatrix4("view",l),s.Shader.setTexture("tex",0),s.Texture.setActive(0,"texture");let c=[[-6,-6,-6],[6,-6,-6],[-6,-6,6],[6,-6,6],[-6,6,-6],[6,6,-6],[-6,6,6],[6,6,6]];for(const e of c){let i=s.Matrix.model3D(e,[4*t,4*t,4*t],[1,1,1]);s.Shader.setMatrix4("model",i),s.Mesh.draw("mesh_cube")}}}}t.Canvas3=x},353:function(e,t,i){var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(t,i);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,r)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)"default"!==i&&Object.prototype.hasOwnProperty.call(e,i)&&n(t,e,i);return r(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.Canvas=void 0;const s=o(i(290));class a{constructor(e,t){this.id=e;let i=document.getElementById(this.id);if(null!=i){a._canvases.set(this.id,this),s.Context.create(this.id,i,t),s.Context.bind(this.id);let e=s.Context.getContainer(this.id),n=document.createElement("button"),r=this.id;n.className="devon-webgl-canvas-container",n.innerText="Fullscreen",n.onclick=function(){s.Context.setFullscreen(r)},e.after(n)}}static update(e,t){this._canvases.forEach((function(i){(!a._fullscreen||a._fullscreen&&a._fullscreenCanvas==i)&&(s.Context.bind(i.id),i.update(e,t),s.Context.draw())}))}}t.Canvas=a,a._canvases=new Map},318:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.fragShaderLib=void 0,t.fragShaderLib="uniform vec2 resolution;\nuniform float time;\nuniform float frame;\nuniform float randomSeed;\n\n// Pi\n#define PI 3.1415926535897932384626433832795\n\n// RGB color to HSV color\nvec3 rgbToHSV(vec3 c)\n{\n\tvec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\n\tvec4 p = mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));\n\tvec4 q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));\n\tfloat d = q.x - min(q.w, q.y);\n\tfloat e = 1.0e-10;\n\treturn vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);\n}\n\n// HSV color to RGB color\nvec3 hsvToRGB(vec3 c)\n{\n\tvec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\n\tvec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\n\treturn c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n}\n\n// Get sine of angle shifted into range\nfloat sinRange(float a, float min, float max)\n{\n\tfloat mult = abs(max - min) / 2.0;\n\treturn (sin(a) * mult) + abs(max - mult);\t\n}\n\n// Get cosine of angle shifted into range\nfloat cosRange(float a, float min, float max)\n{\n\tfloat mult = abs(max - min) / 2.0;\n\treturn (cos(a) * mult) + abs(max - mult);\t\n}\n\n// Get noise value (randomized)\nfloat noise(vec2 coord, float seed)\n{\n\treturn fract(sin(dot(coord + seed, vec2(12.9898, 78.233))) * 43758.5453) * (1.0 / 0.9999);\n}\n\n// Get noise value\nfloat noise(vec2 coord)\n{\n\treturn fract(sin(dot(coord, vec2(12.9898, 78.233))) * 43758.5453) * (1.0 / 0.9999);\n}\n\n// Get random value\nfloat random()\n{\n\treturn noise(vec2(randomSeed));\n}\n\n// Get random value\nfloat random(float seed)\n{\n\treturn noise(vec2(seed));\n}\n"}},t={};function i(n){var r=t[n];if(void 0!==r)return r.exports;var o=t[n]={exports:{}};return e[n].call(o.exports,o,o.exports,i),o.exports}(()=>{const e=i(353),t=i(155),n=i(876),r=i(239);let o=0,s=(new t.Canvas1("test-canvas"),new n.Canvas2("test-canvas-2"),new r.Canvas3("test-canvas-3"));document.getElementById("bad-apple").onclick=function(){s.video.play()},requestAnimationFrame((function t(i){e.Canvas.update(i,o++),requestAnimationFrame(t)}))})()})();